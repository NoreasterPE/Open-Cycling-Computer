UI
- BLE device list expiry time. Currently never expires
- There is no way to disconnect from a BLE device
- Fix icon lines width - it's not consistent
- reduce debug settings to 1 screen 2x4

CODING STYLE:
- [EMPTY]

REAL WORLD PROBLEMS:
- Max speed will be false sooner or later after a single invalid measurement. Kalman filter required.
- Average cadence to be calculated for ride time (reset with ride time?)
- Do not try to initialise subsystems too many times. If BLE/GPS/other sensor is not there it won't magically show up. Log error and give up.
- Add a module to allow real live raw data monitoring
- Use Kalman filter for speed - BLE SC goes crazy sometimes
- Use Kalman filter for heart rate - ble_hr goes crazy sometimes
- Use Kalman filter for cadence - ble_sc goes crazy sometimes
- Quit/Halt should render some exit screen
- BLE device name might be too long for assigned space. Split or cut. Use i4oled code if needed.
- Set up low battery warning/shutdown. Pimoroni Lipo shim informs about battery state.
- units_allowed should come from unit_coonverter
- slope in % needs different formatting than in m/m
- create editor_list for list selection (wheel size)
- add session_distance
- changing MSLP or reference_altitude triggers crazy slope. Reset slope calcs variables or filter the jump

CODE ERRORS:
- Threads write to log aftred log end [ERROR]
- Setting time from GPS for the first time breaks delta (trip time)
- Average cadence and heart rate are invalid [IN PROGRESS]

HARDWARE:
- Add backlight control
- Is it possible to read date/time from GPS chip with no fix or a separate clock is needed?
- Fix lost should be marked in log? {Yes, as DEBUG}

OPTIONAL:
- show all available unit s in unit editor
- add colours to layout
- short click to show help
- grey out not used params, like rider_weight
- consider splitting layout into one-page-per-file
- Click to switch value i.e. click on temperature to cycle over min/average/max
- Consider scroll-over-the-edge to switch pages
- Consider icons instead of Accept/Cancel/+/-/<--/-->
- Button maps with colour images
- Auto reload layout on date time of modification change might be handy
- Explore python-osmgpsmap
- Formating might need to be unit dependent. Showing distance in [m] with decimal point doesnt make sense

FUTURE
- Use real ff fonts instead of the "toy" cairo API
- Make library for layout handling. Might be useful for other projects like weather station [IN PROGRESS]

RANDOM ERRORs:
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/usr/lib/python3.4/threading.py", line 920, in _bootstrap_inner
    self.run()
  File "/home/pi/Open-Cycling-Computer/code/src/sensors.py", line 110, in run
    self.load_plugins()
  File "/home/pi/Open-Cycling-Computer/code/src/sensors.py", line 104, in load_plugins
    self.sensors[plugin] = plugin_class()
  File "/home/pi/Open-Cycling-Computer/code/src/plugins/compute.py", line 34, in __init__
    self.s.request_parameter("odometer", self.extra["module_name"])
  File "/home/pi/Open-Cycling-Computer/code/src/sensors.py", line 258, in request_parameter
    if sensor_name not in self.parameters[parameter_name]["required_by"]:
TypeError: argument of type 'NoneType' is not iterable


[DONE]
1. [DONE] Saving setting (i.e. current layout)
2. [DONE] Split module tests from main part and use consistent naming
3. [DONE] When bmp183 is not connected Ctrl-C doesn't quit occ.py 
4. [DONE] Add visualisation of clickable areas for easy debugging
5. [DONE] Editing units (selection list)
6. [DONE] Conversion table for units, start with basic km <-> mph
7. [DONE] Editing single digits in numbers
8. [DONE] Avoid highlighting when sweeping (MOUSEMOTION should be OK for that)
9. [DONE] Find a solutin to black square under hidden cursor. pygame.mouse.set_pos() ? - Solved with 90dbdfc0eb8f1b7ce115eee0e0f942bcdadb1c97
11. [DONE] Use this for rel_movement: >>> from operator import add >>> map(add, list1, list2)
15. [DONE] Allow for changing units of non-editable params like speed or temperature. Block edit in editor but leave unit switching?
16. [DISCARDED] Reading time since boot from gps? - there is no need fo this
17. [DONE] Logging to file to debug field test crashes
18. [DONE] Setup formatting for logger as per https://docs.python.org/2/library/logging.html
19. [DONE] Add more logging, dump ride params to log?
20. [DONE] Cut down logging without losing information
21. [IN TESTING - see MOD[20] Rare error on start
	Exception in thread Thread-1:
	Traceback (most recent call last):
	  File "/usr/lib/python2.7/threading.py", line 552, in __bootstrap_inner
	    self.run()
	  File "/home/pi/OpenCyclingComputer/src/gps_mtk3339.py", line 51, in run
	    self.data.next()
	  File "/usr/lib/python2.7/dist-packages/gps/gps.py", line 311, in next
	    if self.read() == -1:
	  File "/usr/lib/python2.7/dist-packages/gps/gps.py", line 302, in read
	    self.__oldstyle_shim()
	  File "/usr/lib/python2.7/dist-packages/gps/gps.py", line 267, in __oldstyle_shim
	    self.fix.time = isotime(self.utc.encode("ascii"))
	  File "/usr/lib/python2.7/dist-packages/gps/misc.py", line 97, in isotime
	    return calendar.timegm(time.strptime(date, "%Y-%m-%dT%H:%M:%S")) + float("0." + msec)
	ImportError: Failed to import _strptime because the import lockis held by another thread.
	Update: twice same error showed up in my code
22. [DONE] Use for exceptions logging: Logger.exception(msg, *args, **kwargs)
23. [DONE] Add option for easy rendering icons, like a small image that is overlapped on top of background.
24. [DONE] Units switching for non-editable parameters
25. [DONE] Saving preferred units to config file
26. [DONE - text file] Database setup + full ride logging. Or just text file and normal logging?
	http://bytes.com/topic/python/answers/44055-logging-two-files
29. [DONE] Read time from GPS when it will be battery powered
30. [DONE] Read config_base if there is no config.xml file
32. [DONE] Resetting records
33. [DONE] Add total_time (no speed trigger)
34. [DONE] Speed gets stuck when loosing fix at speed != 0
35. [DONE] for pressure] Kalman for altitude
36. [DONE] [in settings] Unit editor for non-editabl parameters like speed. Long click to trigger. Or units in Settings?
37. [DONE] Mousemove turn off highlight
39. [DONE] Resetng speed_max doesn't wrk
40. [DONE] Setting home altitude has to trigger sea level pressure recalculation
41. [DONE] Icons with different states, i.e. to show gps signal strength
43. [DONE] Error after stopping gpsd:
	Exception in thread Thread-1:
	Traceback (most recent call last):
	  File "/usr/lib/python2.7/threading.py", line 552, in __bootstrap_inner
	    self.run()
	  File "/home/pi/OpenCyclingComputer/src/gps_mtk3339.py", line 112, in run
	    self.fix_mode = fix_mode[0]
	KeyError: 0
44. [DONE] Setting time from gps is breaking distance calculations. (time shift * speed is added to distance). Record time shift and make correction?
45. [TESTING] Replace speed_gps_noise with hardware option
46. [DONE] Remove oversampling of pressure when Kalman filter is in place
48. [TESTING] Ridetime, ridetime_total, odometer  are affected by time shift
49. [DONE] Altitude goes crazy in simulation mode and stabilises on 2052m
50. [DONE] GPS doesn't come back after gpsd restart
51. [DONE] Add easy option to finish simulation on non RPI hardware
52. [DONE] Use dict for ride_parameters.py parameters
53. [DONE] Crash when no config/config.xml file
54. [DONE] Editing Rider weight doesn't work - missing value.
55. [DONE] Move wheel size to config
56. [DONE] Switch from XML to YAML for layout description
57. [DONE] Switch from XML to YAML for config file
58. [DONE] Add icon showing BLE connection status
59. [DONE] Add BLE icons
60. [DONE] Switch to self.log.critical("Loading default layout {} failed, Quitting...".format(layout_path), extra=M) style
61. [WONTFIX] Use sprites to make smooth page switching? {pygame is gone, so no sprites}
62. [DONE] Remove pygame
63. [DONE] Crash on rider weight unit change when there is a leading zero - remove leading zero immediately when not needed?
$ python src/occ.py
Exception in thread Thread-3:
Traceback (most recent call last):
  File "/usr/lib64/python2.7/threading.py", line 804, in __bootstrap_inner
    self.run()
  File "/home/przemo/occ/OpenCyclingComputer/Open-Cycling-Computer/code/src/rendering.py", line 23, in run
    self.layout.render_page()
  File "/home/przemo/occ/OpenCyclingComputer/Open-Cycling-Computer/code/src/layout.py", line 158, in render_page
    self.render(self.screen)
  File "/home/przemo/occ/OpenCyclingComputer/Open-Cycling-Computer/code/src/layout.py", line 227, in render
    rv2 = uv[i]
IndexError: string index out of range
64. [DONE] BLE Notifications re-enabled on quit??. Update: look like notificationc can show up even when switched off? {Yes, they can}
[DEBUG] [BLE] Notification received from : 0xe
[DEBUG] [BMP] pressure = 101300.0 Pa, temperature = 19.8 degC
[DEBUG] [BMP] pressure = 101300.0 Pa, temperature = 19.8 degC
[INFO ] [RP] Stopping sensors thread
[DEBUG] [SE] Stopping ble thread
[DEBUG] [BLE] Stop called
[DEBUG] [BMP] pressure = 101300.0 Pa, temperature = 19.8 degC
[DEBUG] [BMP] pressure = 101300.0 Pa, temperature = 19.8 degC
[DEBUG] [BLE] Disabling notifications
[DEBUG] [BLE] Enabling notifications <------------------------------
[DEBUG] [BLE] Notification received from : 0xe
[DEBUG] [BLE] Notification received from : 0xe
[DEBUG] [BLE] Disconnecting..
[DEBUG] [BLE] Disconnected
[DEBUG] [SE] Stopping bmp183 thread
[DEBUG] [BMP] stop
[DEBUG] [BMP] __del__
[DEBUG] [BMP] stop
[DEBUG] [SE] Stopping gps thread
[DEBUG] [OCC] Writing config file
[DEBUG] [OCC] Log end
65. [DONE] Missing image causes hard crash
$ python src/occ.py 
Exception in thread Thread-4:
Traceback (most recent call last):
  File "/usr/lib64/python2.7/threading.py", line 804, in __bootstrap_inner
    self.run()
  File "/home/przemo/software/occ/OpenCyclingComputer/Open-Cycling-Computer/code/src/rendering.py", line 23, in run
    self.layout.render_page()
  File "/home/przemo/software/occ/OpenCyclingComputer/Open-Cycling-Computer/code/src/layout.py", line 165, in render_page
    self.render(self.screen)
  File "/home/przemo/software/occ/OpenCyclingComputer/Open-Cycling-Computer/code/src/layout.py", line 199, in render
    screen.blit(image, [text_center_x, text_center_y])
TypeError: argument 1 must be pygame.Surface, not None
66. Add parent class for BLE to solve locking during initialisation [DONE] {Not by a parent class, but not blocking init is in place}
67. [DONE] Pulse speed/cadence icon every time ble notification is received
68. [DONE] BLE_HR main loop sometimes quit with some unhandled exception
69. [DONE] Change log formatting. Timestamp should be first in human readable format
70. [DONE] Indicate BLE connection on screen
71. [WONTFIX] Control rounding errors when switching units in editor {Concepcion change, no more switching units when editing a number}
72. [WONTFIX] Review & avoid try/catch. It's too expensive {Lean try-except is OK}
73. [DONE] Add a standard parent class for hardware module running in a separate thread (init, start, run, stop, get_data) [IN PROGRESS]
74. [WONTFIX] Add new params from modules to ride parameters? Modules to give ready for use values?
    Help standarisation, but makes splitting code into libs harder. {Concepcion change, modules where possible}
75. [DONE] Define sensor module API (init, get_data, get_formatting, start, stop, get_status) [IN PROGRESS]
76. [DONE] Pulse heart rate icon every time ble notification is received
77. [DONE] reset function to bmp183
78- [DONE] Verify button size. Some are not matching the boxes.
79. [DONE] Sensor reset_data should be based on a set of initial values, p_default
89. [DONE] Errors when no bmp183 or gps present
90. [DONE] Slope to be ignored if t's less than 2%. bmp183 sensor resolution is 0.18m and on distance 8.4m that gives 2.14%,
  distance 8.3m allows to give one measurement per second at 30 km/h. Upgrade to bmp280 should make significant improvement.
91. [DONE]New editor layout. Current is confusing.
92. [DONE]Use timestamp to discard false notifications BLE HR/SC
93. [DONE] {dict with sensor name used} Define universal parameters set, so 3rd party modules or upgrades won't require changes. Currently parameters are hard prefixed with module name.
       solutions:
            - config file with mapping i.e. temperature = bmp183_temperature
            - prefix in dictionary and keep generic names. It would required some parameter registration (check linux kernel and driver reqistration)
94. [WONTFIX[ - Remove get_raw_data dict definition. Add self.params to sensor class {conception change}
95. [DONE] - Fix inconsistent naming: func, function, param_name
96. [DONE] - ride_parameters to be reduced/removed when compute module takes over all calcs
97. [DONE] - Add separate page for units. Slope, pressure
98. [DOME] - Average speed units to be changed with speed units. Required cleaning ride_parameters code first.
99. [DONE] - pressure_at_sea_level is sometimes updated even if there was no change in reference_altitude [TBC]
100. [DONE] - Use METAR to calibrate altitude (internet connecion needed) {user input of MSLP}
101. [DONE] - Make threads stoppable with feedback for clean exit (low priority)
102. [DOME] - leading zero needs to be preserved in editor_number when value is less than 1.0 like 0.5
103. [DONE] - Use time_stamp for all parameters {can be done with custom dict type, but that triggers custom yaml writer/reader. Won't fix}
104. [DONE] - Add text align options to layout (left/center/right)
105. [DONE] - Loading sensor modules from files in a sub-directory
106. [DONE] - max cadence reset doesn't work
107. [DONE] - Ride log configuration in a config file
